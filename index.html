<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petição Previdenciária - Itinerância 2025</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1cm;
      font-size: 12px;
      background: white;
    }
    header, footer {
      text-align: center;
    }
    header img, footer img {
      width: 100%;
    }
    h1 {
      font-size: 16px;
      text-align: center;
      margin-top: 1rem;
    }
    .field-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }
    .field {
      flex: 1;
      min-width: 120px;
    }
    .field-full {
      width: 100%;
      margin-bottom: 0.5rem;
    }
    label {
      display: block;
      margin-bottom: 2px;
    }
    input[type="text"], input[type="number"], input[type="date"], input[type="tel"], select {
      width: 100%;
      padding: 4px;
      font-size: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .checkbox-group {
      margin-bottom: 0.5rem;
      display: flex;
      flex-wrap: wrap;
    }
    .checkbox-group label {
      width: 48%;
      margin-bottom: 2px;
    }
    .assinaturas {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
    }
    .assinaturas div {
      width: 45%;
      text-align: center;
    }
    .assinaturas input {
      width: 90%;
      border: none;
      border-bottom: 1px solid #000;
      text-align: center;
      font-weight: bold;
    }
    .final-group {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
    }
    .final-group p {
      margin: 0;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .submit-print {
      text-align: center;
      margin-top: 2rem;
    }
    .submit-print button {
      padding: 8px 16px;
      font-size: 12px;
      background-color: #0055a5;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .submit-print button:hover {
      background-color: #004080;
    }
    #statusMsg {
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    @media print {
      .submit-print, #secaoJudiciaria { display: none; }
      select, input { border: none; }
    }
  </style>
</head>
<body>
  <header>
    <img src="C:/Users/leofo/OneDrive/Desktop/cabecalho.png" alt="Cabeçalho Justiça Itinerante">
  </header>

  <h1>EXCELENTÍSSIMO(A) SENHOR(A) JUIZ(A) FEDERAL DOS JUIZADOS ESPECIAIS FEDERAIS DA SEÇÃO JUDICIÁRIA DO <span id="secaoDisplay"></span></h1>
  <select id="secaoJudiciaria" onchange="document.getElementById('secaoDisplay').textContent = this.value.toUpperCase();">
    <option value="">-- selecione --</option>
    <option value="Amazonas">Amazonas</option>
    <option value="Acre">Acre</option>
  </select>

  <div class="field-full"><label>Nome Completo:<input type="text" id="nome"></label></div>
  <div class="field-group">
    <div class="field"><label>CPF:<input type="text" id="cpf"></label></div>
    <div class="field"><label>RG:<input type="text" id="rg"></label></div>
    <div class="field"><label>Data de Nascimento:<input type="date" id="dataNascimento" onchange="calcularIdade()"></label></div>
    <div class="field"><label>Idade:<input type="number" id="idade" readonly></label></div>
    <div class="field"><label>Estado Civil:<input type="text" id="estadoCivil"></label></div>
  </div>
  <div class="field-full"><label>Profissão:<input type="text" id="profissao"></label></div>
  <div class="field-group">
    <div class="field"><label>Escolaridade:<input type="text" id="escolaridade"></label></div>
    <div class="field"><label>Nacionalidade:<input type="text" id="nacionalidade"></label></div>
  </div>
  <div class="field-full"><label>Logradouro:<input type="text" id="logradouro"></label></div>
  <div class="field-group">
    <div class="field"><label>Número:<input type="text" id="numero"></label></div>
    <div class="field"><label>Complemento:<input type="text" id="complemento"></label></div>
    <div class="field"><label>Bairro:<input type="text" id="bairro"></label></div>
    <div class="field"><label>Cidade:<input type="text" id="cidade"></label></div>
    <div class="field"><label>Telefone:<input type="tel" id="telefone"></label></div>
  </div>

  <p style="margin-top: 1rem; text-align: justify;">
    Afirma o(a) Autor(a) que faz jus à concessão do benefício previdenciário/assistencial:
  </p>
  <div class="checkbox-group" id="beneficios">
    <label><input type="checkbox" value="Aposentadoria por idade rural"> Aposentadoria por idade rural</label>
    <label><input type="checkbox" value="Aposentadoria por idade urbana"> Aposentadoria por idade urbana</label>
    <label><input type="checkbox" value="Aposentadoria por invalidez rural"> Aposentadoria por invalidez rural</label>
    <label><input type="checkbox" value="Aposentadoria por invalidez urbana"> Aposentadoria por invalidez urbana</label>
    <label><input type="checkbox" value="Auxílio-doença urbano"> Auxílio-doença urbano</label>
    <label><input type="checkbox" value="Auxílio-doença rural"> Auxílio-doença rural</label>
    <label><input type="checkbox" value="Salário-maternidade"> Salário-maternidade</label>
    <label><input type="checkbox" value="Auxílio-reclusão"> Auxílio-reclusão</label>
    <label><input type="checkbox" value="Pensão por morte"> Pensão por morte</label>
    <label><input type="checkbox" value="Pensão vitalícia soldado da borracha"> Pensão vitalícia soldado da borracha</label>
    <label><input type="checkbox" value="LOAS"> LOAS</label>
  </div>
  <p style="margin-top: 0.5rem; text-align: justify;">
    Restando preenchidos os requisitos legais, requer:
  </p>
  <ol>
    <li>A concessão dos benefícios da justiça gratuita;</li>
    <li>Que seja condenado o INSS a conceder ao(à) Autor(a) o benefício previdenciário/assistencial supra.</li>
    <li>A renúncia ao que exceder à soma de 60 (sessenta) salários-mínimos.</li>
  </ol>
  <p style="margin-top: 0.5rem;">
    Valor da causa, até 60 (sessenta) salários-mínimos.
  </p>

  <div class="final-group">
    <p><strong>Local:</strong> <input type="text" id="local"></p>
    <p><strong>Data:</strong> <input type="date" id="dataAtual"></p>
  </div>

  <div class="assinaturas">
    <div>
      <p>__________________________<br>AUTOR</p>
    </div>
    <div>
      <p>__________________________<br>ATERMADOR</p>
      <input type="text" id="atermador" placeholder="Nome do(a) Atermador(a)">
    </div>
  </div>

  <div class="submit-print">
    <p id="statusMsg"></p>
    <button onclick="salvarFormulario()">Salvar</button>
    <button id="btnImprimir" onclick="imprimirFormulario()">Imprimir</button>
  </div>

  <footer>
    <img src="C:/Users/leofo/OneDrive/Desktop/rodape.png" alt="Rodapé CNJ">
  </footer>
</body>

<script>
let formularioSalvo = false;

function calcularIdade() {
  const nascimento = document.getElementById('dataNascimento').value;
  const campoIdade = document.getElementById('idade');
  if (nascimento) {
    const hoje = new Date();
    const nascimentoData = new Date(nascimento);
    let idade = hoje.getFullYear() - nascimentoData.getFullYear();
    const m = hoje.getMonth() - nascimentoData.getMonth();
    if (m < 0 || (m === 0 && hoje.getDate() < nascimentoData.getDate())) {
      idade--;
    }
    campoIdade.value = idade;
  }
}

function preencherDataAtual() {
  const hoje = new Date();
  const dia = String(hoje.getDate()).padStart(2, '0');
  const mes = String(hoje.getMonth() + 1).padStart(2, '0');
  const ano = hoje.getFullYear();
  document.getElementById('dataAtual').value = `${ano}-${mes}-${dia}`;
  atualizarEstatisticas();
}

function validarCamposObrigatorios() {
  const obrigatorios = [
    { id: 'nome', label: 'Nome' },
    { id: 'cpf', label: 'CPF' },
    { id: 'dataNascimento', label: 'Data de Nascimento' },
    { id: 'atermador', label: 'Nome do Atermador' }
  ];

  for (let campo of obrigatorios) {
    const valor = document.getElementById(campo.id).value.trim();
    if (!valor) {
      alert(`Por favor, preencha o campo obrigatório: ${campo.label}`);
      return false;
    }
  }
  return true;
}

function salvarFormulario() {
  if (!validarCamposObrigatorios()) return;
  const linha = coletarDados();
  adicionarLinhaCSV(linha);

  const status = document.getElementById('statusMsg');
  status.textContent = '✔ Formulário salvo com sucesso!';
  status.style.backgroundColor = '#e0ffe0';
  status.style.border = '1px solid #00aa00';
  status.style.color = '#006600';

  formularioSalvo = true;
  document.getElementById('btnImprimir').disabled = false;
  atualizarEstatisticas();
}

function imprimirFormulario() {
  if (!formularioSalvo) {
    alert('Você precisa salvar o formulário antes de imprimir.');
    return;
  }
  window.print();
}

function coletarDados() {
  const campos = [
    'secaoJudiciaria', 'nome', 'cpf', 'rg', 'dataNascimento', 'idade', 'estadoCivil',
    'profissao', 'escolaridade', 'genero', 'logradouro', 'numero', 'complemento',
    'bairro', 'cidade', 'telefone', 'local', 'dataAtual', 'atermador'
  ];
  const dadosCampos = campos.map(id => document.getElementById(id)?.value?.replace(/;/g, ',') || '');

  const beneficiosSelecionados = Array.from(document.querySelectorAll('#beneficios input[type=checkbox]:checked'))
    .map(cb => cb.value).join(', ');

  dadosCampos.push(beneficiosSelecionados);
  return dadosCampos;
}

function adicionarLinhaCSV(novaLinha) {
  const hoje = new Date();
  const nomeArquivo = `${hoje.getFullYear()}${String(hoje.getMonth() + 1).padStart(2, '0')}${String(hoje.getDate()).padStart(2, '0')}_formulario_previdenciario.csv`;
  const header = 'Seção Judiciária;Nome;CPF;RG;Nascimento;Idade;Estado Civil;Profissão;Escolaridade;Gênero;Logradouro;Número;Complemento;Bairro;Cidade;Telefone;Local;Data;Atermador;Benefícios';
  const storageKey = `csv_${nomeArquivo}`;

  let linhas = JSON.parse(localStorage.getItem(storageKey) || '[]');
  linhas.push(novaLinha);
  localStorage.setItem(storageKey, JSON.stringify(linhas));
}

function exportarCSVManual() {
  const hoje = new Date();
  const nomeArquivo = `${hoje.getFullYear()}${String(hoje.getMonth() + 1).padStart(2, '0')}${String(hoje.getDate()).padStart(2, '0')}_formulario_previdenciario.csv`;
  const header = 'Seção Judiciária;Nome;CPF;RG;Nascimento;Idade;Estado Civil;Profissão;Escolaridade;Gênero;Logradouro;Número;Complemento;Bairro;Cidade;Telefone;Local;Data;Atermador;Benefícios';
  const storageKey = `csv_${nomeArquivo}`;
  const linhas = JSON.parse(localStorage.getItem(storageKey) || '[]');
  if (linhas.length === 0) {
    alert('Nenhum dado para exportar.');
    return;
  }
  const csvContent = 'data:text/csv;charset=utf-8;encoding=utf-8,' + '\uFEFF' +
    [header, ...linhas.map(row => row.join(';'))].join('\n');

  const encodedUri = encodeURI(csvContent);
  const link = document.createElement('a');
  link.setAttribute('href', encodedUri);
  link.setAttribute('download', nomeArquivo);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function atualizarEstatisticas() {
  const hoje = new Date();
  const nomeArquivo = `${hoje.getFullYear()}${String(hoje.getMonth() + 1).padStart(2, '0')}${String(hoje.getDate()).padStart(2, '0')}_formulario_previdenciario.csv`;
  const storageKey = `csv_${nomeArquivo}`;
  const linhas = JSON.parse(localStorage.getItem(storageKey) || '[]');

  document.getElementById('contadorPreenchidos').textContent = linhas.length;

  const beneficios = {};
  const generos = {};
  linhas.forEach(l => {
    const genero = l[9];
    generos[genero] = (generos[genero] || 0) + 1;

    const benefs = l[20]?.split(', ');
    benefs?.forEach(b => {
      beneficios[b] = (beneficios[b] || 0) + 1;
    });
  });

  document.getElementById('estatisticasBeneficios').textContent = Object.entries(beneficios)
    .map(([b, c]) => `${b}: ${c}`).join(' | ');

  document.getElementById('estatisticasGenero').textContent = Object.entries(generos)
    .map(([g, c]) => `${g}: ${c}`).join(' | ');
}

window.onload = () => {
  preencherDataAtual();
  document.getElementById('btnImprimir').disabled = true;
};
</script>

<div class="submit-print">
  <p id="statusMsg"></p>
  <button onclick="salvarFormulario()">Salvar</button>
  <button id="btnImprimir" onclick="imprimirFormulario()">Imprimir</button>
  <button onclick="exportarCSVManual()">Exportar CSV</button>
  <div style="margin-top: 1rem;">
    <strong>Total de formulários preenchidos hoje:</strong> <span id="contadorPreenchidos">0</span><br>
    <strong>Distribuição por benefício:</strong> <span id="estatisticasBeneficios">-</span><br>
    <strong>Distribuição por gênero:</strong> <span id="estatisticasGenero">-</span>
  </div>
</div>
</html>
